# VAP SDK CI Example
# Template for testing VAP SDK integration in your project
# Copy and customize for your needs

name: CI - VAP SDK Tests

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  PYTHON_VERSION: "3.11"

jobs:
  lint:
    name: Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install linters
        run: |
          python -m pip install --upgrade pip
          pip install ruff black isort

      - name: Run Ruff
        run: ruff check . --ignore E501
        continue-on-error: true

      - name: Check formatting
        run: black --check --diff .
        continue-on-error: true

  test:
    name: Tests
    runs-on: ubuntu-latest
    needs: lint

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest pytest-asyncio

      - name: Run tests
        env:
          # Use test/mock API key for unit tests
          VAP_API_KEY: ${{ secrets.VAP_API_KEY }}
        run: |
          pytest tests/ -v

  integration:
    name: Integration Tests
    runs-on: ubuntu-latest
    needs: test
    # Only run integration tests if API key is available
    if: ${{ secrets.VAP_API_KEY != '' }}

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest pytest-asyncio

      - name: Run integration tests
        env:
          VAP_API_KEY: ${{ secrets.VAP_API_KEY }}
          VAP_API_URL: https://api.vapagent.com
        run: |
          pytest tests/integration/ -v --tb=short
